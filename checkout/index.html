<!DOCTYPE html>
<html class="no-js" lang="zxx">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="x-ua-compatible" content="ie=edge" />
    <title>Fiama - Flower Shop eCommerce HTML Template</title>
    <meta name="robots" content="noindex, follow" />
    <meta name="description" content="" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />

    <!-- Place favicon.png in the root directory -->
    <link rel="shortcut icon" href="/img/favicon.png" type="image/x-icon" />
    <!-- Font Icons css -->
    <link rel="stylesheet" href="/css/font-icons.css" />
    <!-- plugins css -->
    <link rel="stylesheet" href="/css/plugins.css" />
    <!-- Main Stylesheet -->
    <link rel="stylesheet" href="/css/style.css" />
    <!-- Responsive css -->
    <link rel="stylesheet" href="/css/responsive.css" />
    <!-- Checkout Custom Stylesheet -->
    <link rel="stylesheet" href="/css/checkout-custom.css" />
    <!-- Razorpay Script -->
    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
  </head>

  <body>
    <div class="body-wrapper">
      <!-- HEADER AREA START (Dynamic) -->
      <header id="headerMenu"></header>
      <!-- HEADER AREA END -->
      <!-- Utilize Mobile Menu Start (Dynamic) -->
      <div
        id="ltn__utilize-mobile-menu"
        class="ltn__utilize ltn__utilize-mobile-menu"
      ></div>
      <!-- Utilize Mobile Menu End -->
      <div class="ltn__utilize-overlay"></div>

      <!-- BREADCRUMB AREA START -->
      <div
        class="ltn__breadcrumb-area ltn__breadcrumb-area-4 ltn__breadcrumb-color-white---"
      >
        <div class="container">
          <div class="row">
            <div class="col-lg-12">
              <div class="ltn__breadcrumb-inner text-center">
                <h1 class="ltn__page-title">Checkout</h1>
                <div class="ltn__breadcrumb-list">
                  <ul>
                    <li><a href="/">Home</a></li>
                    <li>Checkout</li>
                  </ul>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <!-- BREADCRUMB AREA END -->

      <!-- WISHLIST AREA START -->
      <div class="checkout-container">
        <!-- Order Summary -->
        <div class="order-summary">
          <h2>Order Summary</h2>

          <div class="checkoutProductDiv">
            <div
              class="d-flex justify-content-center align-items-center"
              style="min-height: 200px"
            >
              <div
                class="spinner-border text-primary"
                role="status"
                style="width: 3rem; height: 3rem"
              >
                <span class="visually-hidden">Loading...</span>
              </div>
            </div>
          </div>

          <div class="cartTotal"></div>
        </div>

        <!-- Payment Methods -->
        <div class="payment-methods">
          <h2>Payment Methods</h2>

          <!-- Razorpay Option -->
          <!-- <div class="payment-option active" onclick="toggleInfo(this)">
            <div class="payment-header">
              <div>
              <img
                src="/img/payments/razorpay.svg"
                alt="Razorpay"
                style="height: 30px"
              />
              </div>
              <i class="fas fa-chevron-down"></i>
            </div>
            <div class="expand-info">
              Fast, secure payments using UPI, Cards or Net Banking via
              Razorpay.
              <button
              class="pay-now"
              id="razorpayBtn"
              onclick="payWithRazorpay(event)"
              >
              Pay with Razorpay
              </button>
            </div>
            </div> -->

          <!-- PhonePe Option -->
          <div class="payment-option active" onclick="toggleInfo(this)">
            <div class="payment-header">
              <div>
                <img
                  src="/img/payments/phone-pe.svg"
                  alt="PhonePe"
                  style="height: 30px"
                />
              </div>
              <i class="fas fa-chevron-down"></i>
            </div>
            <div class="expand-info">
              Pay securely using PhonePe UPI, Wallet, or Cards.
              <button
                class="pay-now"
                id="phonepeBtn"
                onclick="initiatePhonePePayment(event)"
                style="background-color: #5b338a; color: #fff"
              >
                Pay with PhonePe
              </button>
            </div>
          </div>

          <!-- PayPal Option -->
          <!-- <div class="payment-option" onclick="toggleInfo(this)">
      <div class="payment-header">
        <div><img src="/img/payments/paypal.svg" alt="PayPal" style="height: 30px;"></div>
        <i class="fas fa-chevron-down"></i>
      </div>
      <div class="expand-info">
        Pay securely with your PayPal account or linked credit card.
        <button class="pay-now" style="background-color:#ffc439; color:#111;" onclick="payWithPaypal(event)">Pay with PayPal</button>
      </div>
    </div> -->
        </div>
      </div>
      <!-- WISHLIST AREA START -->

      <!-- FOOTER AREA START (Dynamic) -->
      <footer id="footerMenu"></footer>
      <!-- FOOTER AREA END -->

      <!-- Payment Success Modal Start-->
      <div id="paymentModal" style="display: none">
        <div class="modal-overlay">
          <div class="modal-content">
            <span class="close-button" onclick="closeSuccessModal()"
              >&times;</span
            >
            <h2>âœ… Payment Successful!</h2>
            <p class="thank-you">
              Thank you for your purchase. Your order has been placed
              successfully.
            </p>

            <div class="order-details">
              <div class="row">
                <div class="label">Order ID:</div>
                <div class="value" id="orderId">123456789</div>
              </div>
              <div class="row">
                <div class="label">Payment ID:</div>
                <div class="value" id="paymentId">dfdsfd</div>
              </div>
              <div class="row">
                <div class="label">Amount Paid:</div>
                <div class="value" id="amountPaid">â‚¹100.00</div>
              </div>
            </div>

            <div class="actions">
              <a href="/account" class="btn primary">ðŸ“¦ View My Orders</a>
              <a href="/account" class="btn secondary">ðŸ‘¤ Go to My Account</a>
            </div>
          </div>
        </div>
      </div>
      <!-- Payment Success Modal End-->
    </div>
    <!-- All JS Plugins -->
    <script src="/js/plugins.js"></script>
    <!-- Main JS -->
    <script src="/js/main.js"></script>
    <!-- Custom JS -->
    <script src="/js/auth.js"></script>
    <script src="/js/api.js"></script>
    <script src="/js/config.js"></script>
    <script src="/js/common.js"></script>
    <script src="/js/phonepe.js"></script>
    <script>
      // Function to show success modal with payment details
      function showSuccessModal(paymentId, orderId, amount) {
        document.getElementById("paymentId").textContent = paymentId;
        document.getElementById("orderId").textContent = orderId;
        document.getElementById("amountPaid").textContent =
          "â‚¹" + (amount / 100).toFixed(2); // â‚¹
        document.getElementById("paymentModal").style.display = "block";
      }

      function closeSuccessModal() {
        document.getElementById("paymentModal").style.display = "none";
      }
      // Ensure cart modal open logic is always attached after header render
      document.addEventListener("DOMContentLoaded", async function () {
        if (typeof renderHeaderMenu === "function") renderHeaderMenu();
        // Wait for cart modal to be in DOM, then update it
        setTimeout(async function () {
          if (typeof updateCartModal === "function") await updateCartModal();
          const cartMenuToggle = document.querySelectorAll(
            ".mini-cart-icon a, .ltn__utilize-toggle"
          );
          cartMenuToggle.forEach((toggle) => {
            toggle.addEventListener("click", async function (e) {
              e.preventDefault();
              if (typeof openCartModal === "function") {
                await openCartModal(e);
              }
            });
          });
        }, 200); // Wait for header/cart modal render
      });
    </script>

    <script>
      // showSuccessModal("fadfasf", "123456789","dfs");
      window.addEventListener("DOMContentLoaded", async function () {
        const getAllCartItemsResponse = await getCartItems();
        const getAllCartItems = getAllCartItemsResponse.products || [];
        //  console.log('Cart Items:', getAllCartItems);
        const checkoutProductDiv = document.querySelector(
          ".checkoutProductDiv"
        );
        // Example: getAllCartItems = [{...}, {...}]
        if (Array.isArray(getAllCartItems) && getAllCartItems.length > 0) {
          checkoutProductDiv.innerHTML = getAllCartItems
            .map(
              (item) => `
        <div class="product">
          <img src="${
            item.thumbnail ? item.thumbnail : "https://via.placeholder.com/80"
          }" alt="${item.name}">
          <div class="product-info">
         <h4>${item.name}</h4>
      
          </div>
          <div class="product-price">
         ${
           item.slashedPrice
             ? `<span style="text-decoration:line-through;color:#888;">â‚¹${item.slashedPrice}</span> `
             : ""
         }
         â‚¹${item.price}
          </div>
        </div>
      `
            )
            .join("");
        } else {
          checkoutProductDiv.innerHTML = "<div>No items in cart.</div>";
        }
        document.querySelector(".cartTotal").innerHTML = `
         Total: â‚¹${getAllCartItemsResponse?.totalCartPrice}
        `;
      });

      function toggleInfo(el) {
        const all = document.querySelectorAll(".payment-option");
        all.forEach((opt) => opt.classList.remove("active"));
        el.classList.toggle("active");
      }
    </script>
  </body>
</html>
